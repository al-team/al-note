## JavaScript 基础

1. es5 常用语法有哪些 & es6
2. forEach 和 for of 区别
3. 手写： async await
4. 原型链与继承，手写继承
5. 微前端如何做全局变量的隔离，样式隔离，做好沙箱机制
6. 手写 promise 系列
7. 异步题
8. this, 什么是闭包
9. 手写防抖节流

### 闭包题目

```js
var nAdd;
var t = function () {
  var n = 99;
  nAdd = function () {
    n++;
  };
  var t2 = function () {
    console.log(n);
  };
  return t2;
};

var a1 = t();
var a2 = t();

nAdd();

a1(); //99
a2(); //100
```

### 手写 promise 系列

1. promise.all

```js
async function all(promises = []) {
  return new Promise((resolve, reject) => {
    let result = [];
    let count = promises.length;
    if (count === 0) resolve([]); // Promise.all([]) 的情况

    for (let i = 0; i < promises.length; i++) {
      Promise.resolve(promises[i]) // 使用 Promise.resolve 包装。Promise.all([1,2,3]) 的情况
        .then((res) => {
          result[i] = res;
          count--;
          if (count === 0) {
            resolve(result);
          }
        })
        .catch(reject);
    }
  });
}
```

2. Promise.allSettled

```js
async function allSettled(promises = []) {
  return new Promise((resolve, reject) => {
    let result = [];
    let count = promises.length;
    if (count === 0) resolve([]); // Promise.allSettled([]) 的情况
    for (let i = 0; i < promises.length; i++) {
      Promise.resolve(promises[i])
        .then(
          (value) => {
            result[i] = { status: 'fullfilled', value };
          },
          (error) => {
            result[i] = { status: 'rejected', reason: error };
          },
        )
        .finally(() => {
          count--;
          if (count === 0) {
            resolve(result);
          }
        });
    }
  });
}
```

3. Promise.race

```js
function race(promises) {
  return new Promise((resolve, reject) => {
    for (let i = 0; i < promises.length; i++) {
      Promise.resolve(promises[i]).then(resolve).catch(reject);
    }
  });
}
```

### 异步面试题

1. 题 1

```js
const b = () => {
  try {
    async function async1() {
      console.log(1);
      await async2();
      console.log(2);
    }
    //
    async function async2() {
      console.log(3);
    }
    async1(); // 1 3 [2]
    // 1 3 4 7 [2 5]
    new Promise(function (resolve, reject) {
      reject(8);
      console.log(4);
    }).then(() => {
      console.log(6);
    });
    // .catch((e) => {
    //   console.log(5);
    //   console.log('e', e);
    // });
    console.log(7);
  } catch (error) {
    console.log(error);
  }
};
```

2. 题 2

```js
new Promise((resolve, reject) => {
  console.log(1);
  reject(1);
})
  .catch((err) => {
    console.log('catch');
  })
  .then(() => {
    console.log('then');
  });
// 1 catch then

new Promise((resolve, reject) => {
  console.log(1);
  reject(1);
})
  .then(() => {
    console.log('then');
  })
  .catch((err) => {
    console.log('catch');
  });
// 1 catch
```

3. 题 3

```js
const b = () => {
  try {
    async function async1() {
      console.log(1);
      const b = await 99;
      // p1
      console.log(b);
      const c = await async2();
      // p3
      console.log(2);
      console.log(c);
    }
    //
    async function async2() {
      console.log(3);
      return new Promise((resolve, reject) => {
        resolve(98);
      });
    }
    async1();
    new Promise(function (resolve, reject) {
      resolve(8);
      console.log(4);
    })
      .catch((e) => {
        // p4
        console.log(5);
        console.log('e', e);
      })
      .then(() => {
        // p2
        // Promise.reject(100);
        console.log(6);
      });
    console.log(7);
  } catch (error) {
    console.log(error);
  }
};
b();
// 1 4 7 99 3 6 2 98 [100]
```

4. 题 4

```js
const b = () => {
  try {
    async function async1() {
      console.log(1);
      const b = await 99;
      // p1
      console.log(b);
      const c = await async2();
      // p3
      console.log(2);
      console.log(c);
    }
    const lbl = Promise.resolve('101');
    const gsw = Promise.reject('102');
    //
    async function async2() {
      console.log(3);
      return new Promise((resolve, reject) => {
        console.log(lbl);
        setTimeout(() => {
          resolve(98);
        }, 100);
      });
    }
    async1();
    new Promise(function (resolve, reject) {
      resolve(8);
      console.log(4);
    })
      .catch((e) => {
        console.log(5);
        console.log('e', e);
      })
      .then(() => {
        // p2
        Promise.reject(100);
        console.log(6);
      });

    console.log(7);
  } catch (error) {
    console.log(error);
  }
};
// ans 1 4 7 99 3 Promise<101> 6 102 2 98
```

### 随机题

```js
(() => {
  let x, y;
  try {
    throw new Error();
  } catch (x) {
    (x = 1), (y = 2);
    console.log(x);
  }
  console.log(x);
  console.log(y);
})();
```

### 数组扁平化

```js
function flat(arr) {
  return arr.reduce(
    (list, item) => list.concat(Array.isArray(item) ? flat(item) : item),
    [],
  );
}
```
